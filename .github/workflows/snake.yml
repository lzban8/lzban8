name: Generate Snake

# 触发条件
on:
  # 1. 定时触发：每天国际标准时间 0 点运行一次 (大约北京时间早上8点)
  schedule:
    - cron: "0 0 * * *" 
  # 2. 手动触发：允许你在 Actions 页面点击按钮手动运行
  workflow_dispatch:

# 权限设置：允许 Action 写入仓库内容 (新版 GitHub 必须项)
permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # 步骤 1：检出代码
      - uses: actions/checkout@v4

      # 步骤 2：运行贪吃蛇 Action，生成图片
      - uses: Platane/snk@v3
        id: snake-gif
        with:
          github_user_name: ${{ github.repository_owner }} # 自动读取你的用户名
          # 定义输出的文件名。这里生成了两个版本：
          # 1. 普通版 svg
          # 2. 暗色模式版 svg (适应 GitHub 的暗黑主题)
          outputs: |
            dist/github-contribution-grid-snake.svg
            dist/github-contribution-grid-snake-dark.svg?palette=github-dark
        env:
          #如果你有很多私有仓库的提交记录想算进去，需要用 PAT token。
          #如果是公开仓库，直接用自带的 GITHUB_TOKEN 就行，下面这行可以注释掉或删掉
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # 步骤 3：把生成的文件推送到 output 分支
      - uses: crazy-max/ghaction-github-pages@v4
        with:
          # 推送到一个叫 output 的孤儿分支，不污染主分支的历史
          target_branch: output
          build_dir: dist
        env:
          # 使用 GitHub 自带的 Token 进行验证，无需手动设置 Secrets
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
